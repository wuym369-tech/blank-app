#ç›®å‰æ˜¯é¦™èª¿éƒ½é€²å»äº”è¡Œä¹Ÿé€²å»ï¼Œç¾åœ¨è¦å»æ–°å¢èª¿é¦™æ¯”ä¾‹è¦å°
#ç¾åœ¨æ–°å¢æ¯”ä¾‹å°äº†
#ç¾åœ¨è¦æŠŠå„å€‹æ˜Ÿåº§ç”Ÿè‚–çš„ç‰¹è³ªå†å¤šä¸€é»
#ç¾åœ¨è¦æŠŠæœ€å¾Œå‹•ç•«åšå¥½ä¸€é»
#æ–°å¢äº†æ¸¬è©¦äººæ ¼ï¼Œç¾åœ¨åœ¨æ–°å¢å°æ‡‰äº”è¡Œå¹¸é‹è‰²
import streamlit as st
from datetime import date
import time
import random

# 1. é é¢é…ç½® (å¿…é ˆæ”¾åœ¨æœ€é ‚ç«¯)
st.set_page_config(page_title="Aroma's Secret Lab", layout="centered")

# ==========================================
# æ•¸æ“šåº« Aï¼š78 ç¨®é¦™å‘³èˆ‡æ„Ÿæ€§æè¿°
# ==========================================
scent_map = {
    # --- å‰èª¿ (Top Notes) - å…± 20 ç¨® ---
    "å‰èª¿ èŠ³é¦™ 01": "å¯Œå®¶åƒé‡‘ (å°è±†è”»/çƒé¾èŒ¶)",
    "å‰èª¿ èŠ³é¦™ 02": "å¤å¤©çš„é¢¨ (ç¾…å‹’/ç™¾é‡Œé¦™)",
    "å‰èª¿ èŠ³é¦™ 03": "é‡èŠ± (å°è±†è”»/å«ç¾è‰)",
    "å‰èª¿ èŠ³é¦™ 04": "è‚†æ„å¥”æ”¾ (å°è±†è”»/é¦¬éƒè˜­)",
    "å‰èª¿ èŠ³é¦™ 05": "é„‰æ„ (æ¢”å­èŠ±/ç¶ è‘‰/ç”˜è‰)",
    "å‰èª¿ èŠ³é¦™ 06": "èŒ¶æ¨¹ (èŒ¶æ¨¹)",
    "å‰èª¿ èŠ³é¦™ 07": "è–„è· (è–„è·)",
    "å‰èª¿ èŠ³é¦™ 08": "é¦¬é­è‰ (é¦¬é­è‰)",
    "å‰èª¿ èŠ³é¦™ 09": "ç¶ èŒ¶ (ç¶ èŒ¶)",
    "å‰èª¿ æŸ‘æ©˜ 01": "èŠ±åœ’ (æ©˜å­/æª¸æª¬/é–‹å¿ƒæœ)",
    "å‰èª¿ æŸ‘æ©˜ 02": "è¨˜æ†¶èœœç³– (æ©˜å­/æ¡ƒå­)",
    "å‰èª¿ æŸ‘æ©˜ 03": "å¯‚éœç§‹å¤œ (èƒ¡è˜¿è””/ç•ªèŒ„/æ©™å­)",
    "å‰èª¿ æŸ‘æ©˜ 04": "æ°£æ³¡æ°´ (è‘¡è„æŸš/æ©˜å­)",
    "å‰èª¿ æŸ‘æ©˜ 05": "æµ·é‚Šæ¼«æ­¥ (æ©™å­/æª¸æª¬)",
    "å‰èª¿ æŸ‘æ©˜ 06": "æµ·ç˜ (ä½›æ‰‹æŸ‘/æª¸æª¬/é¦™æ©™)",
    "å‰èª¿ æŸ‘æ©˜ 07": "ç´”çœŸ (æ©™å­/èŒ‰è‰/ç¥ç€)",
    "å‰èª¿ æŸ‘è‹” 01": "æ™¨é–“æ£®æ— (ç„¡èŠ±æœæœ¨/é¦™æ ¹è‰)",
    "å‰èª¿ æŸ‘è‹” 02": "ä¿¡ä»° (æ©˜å­/éºé¦™/è‹¦æ©™è‘‰)",
    "å‰èª¿ æŸ‘è‹” 03": "æ¸…æ–° (è‘¡è„æŸš/æ©¡æœ¨è‹”)",
    "å‰èª¿ æŸ‘è‹” 04": "è‹”è˜š (è‹”è˜š)",

    # --- ä¸­èª¿ (Middle Notes) - å…± 34 ç¨® ---
    "ä¸­èª¿ æœé¦™ 01": "å¤æ—¥èŠåœ’ (æŸ‘æ©˜/ç„¡èŠ±æœ)",
    "ä¸­èª¿ æœé¦™ 02": "ç´”ç²¹ (é¦™ç“œ/æ©˜å­/é»ƒç“œ)",
    "ä¸­èª¿ æœé¦™ 03": "ç”œç¾ (è‰è“/æ¢¨/èœœæ©˜)",
    "ä¸­èª¿ æœé¦™ 04": "æƒ…ç«‡åˆé–‹ (ç´…æ¼¿æœ/ç³–)",
    "ä¸­èª¿ æœé¦™ 05": "æ’’ä¸å³¶ (æ©™èŠ±æ²¹/æª¸æª¬)",
    "ä¸­èª¿ æœé¦™ 06": "ä»²å¤èŠ±åœ’ (ç´…è˜‹æœ/ç«ç‘°)",
    "ä¸­èª¿ æœé¦™ 07": "é…¸ç”œè»Ÿå¦¹ (é»‘åŠ ä¾–/è è˜¿/ç„¦ç³–)",
    "ä¸­èª¿ æœé¦™ 08": "åœ°ä¸­æµ· (é¦™è±Œè±†/æª¸æª¬/ç„¦ç³–)",
    "ä¸­èª¿ æœé¦™ 09": "æµ·é‚Šå¾®é¢¨ (é»ƒè‘µ/é¹½)",
    "ä¸­èª¿ æœé¦™ 10": "å’–å•¡å»³ (ç”œè˜‹æœ/é¦™æ©™èŠ±/é¦™è‰)",
    "ä¸­èª¿ æœé¦™ 11": "æŸ‘æ©˜ (æŸ‘æ©˜)",
    "ä¸­èª¿ æœé¦™ 12": "æª¸æª¬ (æª¸æª¬)",
    "ä¸­èª¿ æœé¦™ 13": "ç™¾é¦™æœ (ç™¾é¦™æœ)",
    "ä¸­èª¿ æœé¦™ 14": "é’ç“œ (é’ç“œ)",
    "ä¸­èª¿ æœé¦™ 15": "é’è˜‹æœ (é’è˜‹æœ)",
    "ä¸­èª¿ èŠ±é¦™ 01": "ç™½è¥¯è¡« (è–°è¡£è‰/æ©™èŠ±)",
    "ä¸­èª¿ èŠ±é¦™ 02": "å„ªé›…å¥³äºº (æ™šé¦™ç‰/èŒ‰è‰èŠ±)",
    "ä¸­èª¿ èŠ±é¦™ 03": "é›¨å¾ŒèŠ±åœ’ (ç«ç‘°/ä¾è˜­)",
    "ä¸­èª¿ èŠ±é¦™ 04": "éœè¬èŠ±åœ’ (ç«ç‘°/èŒ‰è‰)",
    "ä¸­èª¿ èŠ±é¦™ 05": "åˆæ˜¥ (ç«ç‘°/èœ‚èœœ)",
    "ä¸­èª¿ èŠ±é¦™ 06": "æ˜¥æ„ç›ç„¶ (èŒ‰è‰/ç¶ è‘‰)",
    "ä¸­èª¿ èŠ±é¦™ 07": "æ¢¨å­é…’ (æ¢¨/å°è’¼è˜­)",
    "ä¸­èª¿ èŠ±é¦™ 08": "æ£®æ—å°å±‹ (è–°è¡£è‰/è‚‰è±†è”»)",
    "ä¸­èª¿ èŠ±é¦™ 09": "ç¨»é¦™ (æ©™èŠ±/é¦™è‰)",
    "ä¸­èª¿ èŠ±é¦™ 10": "ç•°åŸŸé¢¨æƒ… (æ™šé¦™ç‰/ä¾è˜­)",
    "ä¸­èª¿ èŠ±é¦™ 11": "å„ªé›… (èŒ‰è‰/è˜­èŠ±/æå­)",
    "ä¸­èª¿ èŠ±é¦™ 12": "è–°è¡£è‰ (è–°è¡£è‰)",
    "ä¸­èª¿ èŠ±é¦™ 13": "å¤œä¾†é¦™ (å¤œä¾†é¦™)",
    "ä¸­èª¿ èŠ±é¦™ 14": "æ¢”å­èŠ± (æ¢”å­èŠ±)",
    "ä¸­èª¿ èŠ±é¦™ 15": "ä¾è˜­ (ä¾è˜­)",
    "ä¸­èª¿ èŠ±é¦™ 16": "ç«ç‘° (ç«ç‘°)",
    "ä¸­èª¿ èŠ±é¦™ 17": "é¢¨éˆ´è‰ (é¢¨éˆ´è‰)",
    "ä¸­èª¿ èŠ±é¦™ 18": "èŒ‰è‰ (èŒ‰è‰)",
    "ä¸­èª¿ èŠ±é¦™ 19": "æ¡‚èŠ± (æ¡‚èŠ±)",

    # --- å¾Œèª¿ (Base Notes) - å…± 24 ç¨® ---
    "å¾Œèª¿ æ±æ–¹ 01": "é›¨è½å¹½ç„¶ (è‹¦æ©™/ç¥ç€)",
    "å¾Œèª¿ æ±æ–¹ 02": "çƒé¾èŒ¶ (èŒ¶è‘‰/é¦™æ ¹è‰)",
    "å¾Œèª¿ æ±æ–¹ 03": "æ–°å€«æ•¦ç”· (è‚‰æ¡‚/ç…™è‰/æ©¡æœ¨è‹”)",
    "å¾Œèª¿ æ±æ–¹ 04": "å¤è€æ›¸åº— (å†¬åŠ è±†)",
    "å¾Œèª¿ æ±æ–¹ 05": "è¥¿è¥¿é‡Œå³¶ (æä»/é¦™è‰/éºé¦™)",
    "å¾Œèª¿ æ±æ–¹ 06": "é™½å…‰ (ç´«ç¾…è˜­/é¦™è‰/éºé¦™)",
    "å¾Œèª¿ æ±æ–¹ 07": "é«˜å±±å¾®é¢¨ (è¿·è¿­é¦™/å»£è—¿é¦™)",
    "å¾Œèª¿ æ±æ–¹ 08": "å†¬æ—¥å£çˆ (ç¥ç€/éºé¦™)",
    "å¾Œèª¿ æ±æ–¹ 09": "è·çˆ¾è’™ (èŠ±æ¤’/å»£è—¿é¦™)",
    "å¾Œèª¿ æ±æ–¹ 10": "æ³•åœ‹ç´³å£« (æ©˜å­/æª€é¦™æœ¨)",
    "å¾Œèª¿ æ±æ–¹ 11": "æ¢…ç³– (æ¢¨/æä»/é¦™è‰)",
    "å¾Œèª¿ æœ¨è³ª 01": "å†¬æ—¥æ¾æ— (é›ªæ¾/éºé¦™)",
    "å¾Œèª¿ æœ¨è³ª 02": "æ²‰éœæ£®æ— (ç™½æ¾é¦™/æª€é¦™)",
    "å¾Œèª¿ æœ¨è³ª 03": "æ²‰ç©© (èè½/é¦™æ ¹è‰/é›ªæ¾æœ¨)",
    "å¾Œèª¿ æœ¨è³ª 04": "é¾æ¶ (é¾æ¶/ç¥ç€/æœ¨è³ª)",
    "å¾Œèª¿ æœ¨è³ª 05": "é›ªæ¾ (é›ªæ¾)",
    "å¾Œèª¿ æœ¨è³ª 06": "ç©ºéˆ (éºé¦™/æ²‰é¦™)",
    "å¾Œèª¿ æœ¨è³ª 07": "æ™¨é–“å±±é¢¨ (é¦™è‰/æ²‰é¦™)",
    "å¾Œèª¿ æœ¨è³ª 08": "å¯ºå»Ÿ (é»‘èƒ¡æ¤’/æª€æœ¨)",
    "å¾Œèª¿ æœ¨è³ª 09": "é›²éœ§ (è¿·è¿­é¦™/æ¨Ÿæœ¨)",
    "å¾Œèª¿ æœ¨è³ª 10": "æ•…é„‰ (æ²‰é¦™/å»£è—¿é¦™)",
    "å¾Œèª¿ æœ¨è³ª 11": "ç„šé¦™ (æ²‰é¦™/å·´è¥¿ç´…æœ¨)",
    "å¾Œèª¿ æœ¨è³ª 12": "æœˆå…‰æŸæœ¨ (è‹¦æ©™/æŸæ¨¹)",
    "å¾Œèª¿ æœ¨è³ª 13": "æª€é¦™ (æª€é¦™)"
}
scent_descriptions = {
    # --- å‰èª¿ (Top Notes) ---
    "å‰èª¿ èŠ³é¦™ 01": "æ¸…å†·çƒé¾èˆ‡è¾›é¦™å°è±†è”»ç¢°æ’ï¼Œå½·å½¿åœ¨éœ§æ°£ç¹šç¹çš„æ¸…æ™¨èŒ¶å±±ä¸­ç¨åã€‚",
    "å‰èª¿ èŠ³é¦™ 02": "æ¸…æ–°çš„ç¾…å‹’èˆ‡ç™¾é‡Œé¦™äº¤ç¹”ï¼Œå¦‚åŒæ¼«æ­¥åœ¨ç‘æ»¿åˆå¾Œé™½å…‰çš„æ­å¼é¦™è‰åœ’ã€‚",
    "å‰èª¿ èŠ³é¦™ 03": "å«ç¾è‰çš„ç²‰æ„Ÿèˆ‡å°è±†è”»çš„æš–æ„ï¼Œåƒæ˜¯è¸å…¥ä¸€ç‰‡é–‹æ»¿ç„¡åé‡èŠ±çš„éœè¬è’é‡ã€‚",
    "å‰èª¿ èŠ³é¦™ 04": "é¦¬éƒè˜­çš„è—¥è‰æ°£æ¯å¸¶å‹•æ„Ÿæ€§ï¼Œæ•£ç™¼å‡ºä¸€ç¨®ç„¡æ‹˜ç„¡æŸã€è‚†æ„å¥”æ”¾çš„è‡ªç”±æ„Ÿã€‚",
    "å‰èª¿ èŠ³é¦™ 05": "æ¢”å­èŠ±çš„æ½”ç™½èˆ‡ç¶ è‘‰çš„æ¸…è‹¦ï¼Œå‹¾èµ·è¨˜æ†¶ä¸­é‚£æŠ¹æ·¡æ·¡çš„ã€å¸¶æœ‰è‰æœ¨é¦™çš„é„‰æ„ã€‚",
    "å‰èª¿ èŠ³é¦™ 06": "å¼·å‹çš„èŒ¶æ¨¹æ°£æ¯ï¼Œåƒæ˜¯é›¨å¾Œæ£®æ—èˆ¬æ¸…å†½ï¼Œå¸¶çµ¦éˆé­‚æœ€å¾¹åº•çš„æ·¨åŒ–èˆ‡ç”¦é†’ã€‚",
    "å‰èª¿ èŠ³é¦™ 07": "æ¥µè‡´æ¸…æ¶¼çš„è–„è·ï¼Œç¬é–“é»ç‡ƒæ„Ÿå®˜ï¼Œå½·å½¿åœ¨ç‚ç†±å¤æ—¥å–ä¸‹ä¸€å£å†°é®æ³‰æ°´ã€‚",
    "å‰èª¿ èŠ³é¦™ 08": "é¦¬é­è‰çš„æª¸æª¬æ¸…é¦™ï¼Œå¸¶ä¾†è¼•ç›ˆè·³èºçš„æ´»åŠ›ï¼Œè®“å¿ƒæƒ…éš¨ä¹‹é£›æšã€‚",
    "å‰èª¿ èŠ³é¦™ 09": "å„ªé›…çš„ç¶ èŒ¶æ¸…èŠ¬ï¼Œå¦‚åŒç´°é›¨éå¾Œçš„ç«¹æ—ï¼Œå®‰éœã€å…§æ–‚ä¸”å……æ»¿ç¦ªæ„ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 01": "æ©˜å­èˆ‡æª¸æª¬çš„é…¸ç”œï¼Œä¼´éš¨é–‹å¿ƒæœçš„å¾®é¦™ï¼Œåƒæ˜¯ä¸€å ´è‰²å½©ç¹½ç´›çš„èŠ±åœ’æ´¾å°ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 02": "å¤šæ±çš„æ¡ƒå­èå…¥æŸ‘æ©˜ï¼Œç‡Ÿé€ å‡ºè¢«èœœç³–åŒ…è£¹çš„ç«¥å¹´è¨˜æ†¶ï¼Œç”œè€Œä¸è†©ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 03": "èƒ¡è˜¿è””èˆ‡æ©™å­çš„å¥‡å¦™çµåˆï¼Œå¦‚åŒåœ¨ç§‹æ—¥çš„å¯‚éœé»ƒæ˜ï¼Œçœ‹è½è‘‰é‹ªæ»¿å¤§åœ°ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 04": "æ¸…çˆ½å™´æ¹§çš„è‘¡è„æŸšæ°£æ³¡ï¼Œå……æ»¿çˆ†ç™¼åŠ›çš„é…¸ç”œï¼Œç¬é–“ææŒ¯ç²¾ç¥ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 05": "æ²äººå¿ƒè„¾çš„æ¸…çˆ½æŸ‘æ©˜ï¼Œå½·å½¿å…‰è‘—è…³åœ¨æµ·é‚Šæ¼«æ­¥ï¼Œæ„Ÿå—æµªèŠ±è¼•æ‹è…³è¸ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 06": "ä½›æ‰‹æŸ‘çš„è¼•ç›ˆèˆ‡æª¸æª¬çš„æµ·é¢¨æ„Ÿï¼Œè®“æ€ç·’é£„å‘é™é çš„åœ°ä¸­æµ·æ²™ç˜ã€‚",
    "å‰èª¿ æŸ‘æ©˜ 07": "æ©˜å­èˆ‡ç´”çœŸèŒ‰è‰çš„é‚‚é€…ï¼Œåƒæ˜¯å¾®é¢¨ä¸­æ–æ›³çš„ç™½è‰²è£™æ“ºï¼Œç´”æ·¨ä¸”å‹•äººã€‚",
    "å‰èª¿ æŸ‘è‹” 01": "ç„¡èŠ±æœæœ¨èˆ‡é¦™æ ¹è‰çš„çµåˆï¼Œå¦‚åŒæ¸…æ™¨èµ°é€²åŸå§‹æ£®æ—ï¼Œè…³ä¸‹æ˜¯æ½®æ¿•çš„æ³¥åœŸã€‚",
    "å‰èª¿ æŸ‘è‹” 02": "è‹¦æ©™è‘‰èˆ‡éºé¦™çš„æ·±å±¤å…±é³´ï¼Œä»£è¡¨ä¸€ç¨®å…§åœ¨çš„å …å®šï¼Œå¦‚åŒæœè–è€…çš„ä¿¡ä»°ã€‚",
    "å‰èª¿ æŸ‘è‹” 03": "æ©¡æœ¨è‹”èˆ‡è‘¡è„æŸšçš„å†·éœæ„Ÿï¼Œåƒæ˜¯ä¸€é™£ç©¿é€è¿·éœ§çš„æ¸…é¦™ï¼Œå¸¶ä¾†æ¥µè‡´çš„æ¸…é†’ã€‚",
    "å‰èª¿ æŸ‘è‹” 04": "æ½®æ¿•çš„è‹”è˜šæ°£æ¯ï¼Œå¸¶æœ‰ä¸€çµ²æ³¥åœŸçš„èŠ¬èŠ³ï¼Œè®“äººä¸è‡ªè¦ºåœ°å‘å¤§è‡ªç„¶æ·±è™•æ¢ç´¢ã€‚",

    # --- ä¸­èª¿ (Middle Notes) ---
    "ä¸­èª¿ æœé¦™ 01": "æŸ‘æ©˜èˆ‡ç„¡èŠ±æœçš„æš–ç”œï¼Œå½·å½¿ç½®èº«æ–¼å—æ³•èŠåœ’ï¼Œäº«å—æ‚ é–’çš„åˆå¾Œæ™‚å…‰ã€‚",
    "ä¸­èª¿ æœé¦™ 02": "ç”œç¾çš„é¦™ç“œèˆ‡æ¸…æ¶¼é»ƒç“œï¼Œç´”ç²¹å¾—ä¸å¸¶ä¸€çµ²é›œè³ªï¼Œè®“æ„Ÿå®˜ç¬é–“é™æº«ã€‚",
    "ä¸­èª¿ æœé¦™ 03": "è‰è“èˆ‡èœœæ©˜çš„é¦™ç”œï¼Œåƒæ˜¯åˆæˆ€æ™‚å’¬ä¸‹çš„ç¬¬ä¸€å£æ°´æœç³–ï¼Œæ»¿å£èŠ³ç”œã€‚",
    "ä¸­èª¿ æœé¦™ 04": "ç´…æ¼¿æœçš„é…¸ç”œèˆ‡ç³–åˆ†çš„çµåˆï¼Œè­œå¯«å‡ºä¸€æ›²é—œæ–¼æƒ…ç«‡åˆé–‹çš„ç”œèœœæ¨‚ç« ã€‚",
    "ä¸­èª¿ æœé¦™ 05": "æ©™èŠ±æ²¹èˆ‡æª¸æª¬çš„æ¸…å†½ï¼Œå¸¶æ‚¨é£›å‘æ’’ä¸å³¶ï¼Œæ„Ÿå—æµ·é¢¨ä¸­çš„æ¸…çˆ½æœå‘³ã€‚",
    "ä¸­èª¿ æœé¦™ 06": "ç´…è˜‹æœèˆ‡ç«ç‘°çš„äº¤èï¼Œå¦‚åŒåœ¨ä»²å¤çš„èŠ±åœ’ä¸­ï¼Œé‚‚é€…æœ€ç‡¦çˆ›çš„ç››æ”¾ã€‚",
    "ä¸­èª¿ æœé¦™ 07": "é»‘åŠ ä¾–èˆ‡è è˜¿çš„å¥”æ”¾ï¼Œå¸¶æœ‰ä¸€é»ç„¦ç³–çš„ç”œæ½¤ï¼Œå±•ç¾å‡ºé…¸ç”œè»Ÿå¦¹çš„ä¿çš®æ„Ÿã€‚",
    "ä¸­èª¿ æœé¦™ 08": "é¦™è±Œè±†èˆ‡ç„¦ç³–çš„å±¤æ¬¡æ„Ÿï¼Œåƒæ˜¯åœ°ä¸­æµ·é™½å…‰ä¸‹çš„åˆå¾ŒèŒ¶é»ï¼Œæ…µæ‡¶è€Œæ»¿è¶³ã€‚",
    "ä¸­èª¿ æœé¦™ 09": "é»ƒè‘µèˆ‡é¹½çš„çµåˆï¼Œå¦‚åŒæµ·é‚Šæ‹‚éçš„å¾®é¢¨ï¼Œå¸¶æœ‰ä¸€çµ²ä¸éœ²ç—•è·¡çš„è¿·äººé­…åŠ›ã€‚",
    "ä¸­èª¿ æœé¦™ 10": "é¦™æ©™èŠ±èˆ‡é¦™è‰äº¤ç¹”å‡ºçš„æº«æš–ç”œé¦™ï¼Œå½·å½¿å†¬æ—¥åˆå¾Œï¼Œååœ¨ç€°æ¼«é¦™æ°£çš„å’–å•¡å»³ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 01": "è–°è¡£è‰èˆ‡æ©™èŠ±çš„æ½”æ·¨ï¼Œåƒæ˜¯ä¸€ä»¶å‰›åœ¨é™½å…‰ä¸‹æ™¾ä¹¾çš„ç™½è¥¯è¡«ï¼Œè®“äººå€æ„Ÿèˆ’å¿ƒã€‚",
    "ä¸­èª¿ èŠ±é¦™ 02": "æ™šé¦™ç‰èˆ‡èŒ‰è‰çš„æ¿ƒéƒèŠ±é¦™ï¼Œè‡ªä¿¡è€Œå„ªé›…ï¼Œç¶»æ”¾å‡ºæˆç†Ÿå¥³æ€§çš„è¿·äººå…‰å½©ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 03": "ç«ç‘°èˆ‡ä¾è˜­åœ¨é›¨å¾Œæ¿•æ½¤çš„æ°£æ¯ä¸­ç¶»æ”¾ï¼Œå¦‚åŒèµ°å…¥ä¸€åº§ç¥ç¥•ä¸”å¹½éœçš„åº­åœ’ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 04": "ç«ç‘°èˆ‡èŒ‰è‰çš„ç¶“å…¸çµåˆï¼Œå®‰éœåœ°ç››é–‹åœ¨å¿ƒç”°ï¼Œç‡Ÿé€ å‡ºä¸€ä»½å…§å¿ƒçš„éœè¬ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 05": "èœ‚èœœåŒ…è£¹è‘—åˆæ˜¥çš„ç«ç‘°ï¼ŒæŸ”æƒ…ä¼¼æ°´ï¼Œç·©ç·©é‡‹æ”¾å‡ºæ˜¥å¤©æœ€æº«æŸ”çš„è¨Šæ¯ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 06": "èŒ‰è‰èˆ‡ç¿ ç¶ è‘‰ç‰‡çš„æ°£æ¯ï¼Œç”Ÿæ©Ÿç›ç„¶ï¼Œå½·å½¿çœ‹è¦‹æ˜¥èŠ½åœ¨æé ­è¼•è¼•é¡«å‹•ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 07": "æ¢¨èˆ‡å°è’¼è˜­äº¤ç¹”å‡ºçš„å¾®é†ºæ°£æ¯ï¼Œåƒæ˜¯å€’å‡ºä¸€æ¯æ¸…é€çš„æ¢¨å­é…’ï¼Œæ™¶ç‘©å‹•äººã€‚",
    "ä¸­èª¿ èŠ±é¦™ 08": "è–°è¡£è‰èˆ‡è‚‰è±†è”»çš„æº«æš–è¾›é¦™ï¼Œå¦‚åŒèº²é€²å¤§é›ªä¸­çš„æ£®æ—å°å±‹ï¼Œçˆç«æ­£æ—ºã€‚",
    "ä¸­èª¿ èŠ±é¦™ 09": "æ©™èŠ±èˆ‡é¦™è‰çš„æ¸…ç”œï¼Œå¸¶æœ‰ä¸€çµ²ç¨»ç±³çš„æº«æ½¤æ„Ÿï¼Œæ˜¯è±æ”¶å­£ç¯€æœ€å®‰å¿ƒçš„å•å€™ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 10": "ä¾è˜­èˆ‡æ™šé¦™ç‰çš„ç•°åœ‹é¢¨æƒ…ï¼Œç¥ç¥•ä¸”å¤§è†½ï¼Œé ˜æ‚¨è¸ä¸Šä¸€å ´è¯éº—çš„å†’éšªä¹‹æ—…ã€‚",
    "ä¸­èª¿ èŠ±é¦™ 11": "è˜­èŠ±èˆ‡æå­çš„äº¤ç¹”ï¼Œå„ªé›…è€Œä¸å¤±éˆå‹•ï¼Œåœ¨èˆ‰æ‰‹æŠ•è¶³é–“æµéœ²å‡ºé«˜ç´šè³ªæ„Ÿã€‚",
    "ä¸­èª¿ èŠ±é¦™ 19": "æ¸…ç”œå…¥éª¨çš„æ¡‚èŠ±é¦™ï¼Œå½·å½¿åœ¨æŸå€‹ç§‹å¤œçš„è¡—è§’ï¼Œå¶é‡äº†ä¸€å ´é—œæ–¼æœˆå…‰çš„å¤¢ã€‚",

    # --- å¾Œèª¿ (Base Notes) ---
    "å¾Œèª¿ æ±æ–¹ 01": "è‹¦æ©™èˆ‡ç¥ç€çš„ç¢°æ’ï¼Œå¦‚åŒç´°é›¨è½ä¸‹å¾Œçš„å¹½ç„¶æ£®æ—ï¼Œå¸¶è‘—ç¥ç¥•çš„æš–æ„ã€‚",
    "å¾Œèª¿ æ±æ–¹ 02": "èŒ¶è‘‰èˆ‡é¦™æ ¹è‰çš„äº¤èï¼Œå¸¶æœ‰ä¸€ç¨®æ²‰æ¾±éå¾Œçš„æ–‡é›…ï¼Œæ˜¯éˆé­‚æ·±è™•çš„å†·éœã€‚",
    "å¾Œèª¿ æ±æ–¹ 03": "è‚‰æ¡‚èˆ‡ç…™è‰çš„æˆç†ŸéŸ»å‘³ï¼Œå¦‚åŒåœ¨å€«æ•¦è¡—é ­æ¼«æ­¥çš„é«˜é›…ç”·å£«ï¼Œå¾å®¹ä¸”è‡ªä¿¡ã€‚",
    "å¾Œèª¿ æ±æ–¹ 04": "å†¬åŠ è±†çš„é†‡åšæ°£æ¯ï¼Œåƒæ˜¯èµ°é€²ä¸€é–“å¡æ»¿èˆŠæ›¸çš„è€æ›¸åº—ï¼Œæ™‚é–“åœ¨æ­¤å‡å›ºã€‚",
    "å¾Œèª¿ æ±æ–¹ 05": "æä»ã€é¦™è‰èˆ‡éºé¦™çš„åŒ…è£¹ï¼Œå¦‚åŒè¥¿è¥¿é‡Œå³¶çš„æš–é™½ï¼Œæº«æ½¤è€Œä»¤äººé™¶é†‰ã€‚",
    "å¾Œèª¿ æ±æ–¹ 06": "ç´«ç¾…è˜­èˆ‡é¦™è‰çš„è¼•æŸ”å‘¼å¸ï¼Œåƒæ˜¯åœ¨é™½å…‰ä¸‹èˆ’å±•èº«é«”ï¼Œæ„Ÿå—ç”Ÿå‘½æœ€æŸ”è»Ÿçš„æ™‚åˆ»ã€‚",
    "å¾Œèª¿ æ±æ–¹ 07": "è¿·è¿­é¦™èˆ‡å»£è—¿é¦™çš„äº¤çºï¼Œå¦‚é«˜å±±é ‚å³°æ éçš„ç–¾é¢¨ï¼Œæ¸…æ¾ˆä¸”å…·æœ‰ç©¿é€åŠ›ã€‚",
    "å¾Œèª¿ æ±æ–¹ 08": "ç¥ç€èˆ‡éºé¦™ç‡Ÿé€ å‡ºçˆç«èˆ¬çš„æº«åº¦ï¼Œå¦‚åŒåœ¨å¯’å†¬ä¸­ï¼Œé è¿‘æœ€æº«æš–çš„å£çˆã€‚",
    "å¾Œèª¿ æ±æ–¹ 09": "èŠ±æ¤’çš„å¾®è¾›èˆ‡å»£è—¿é¦™çš„æ·±æ²‰ï¼Œé‡‹æ”¾å‡ºå¼·çƒˆçš„è·çˆ¾è’™æ„Ÿï¼Œå±éšªä¸”èª˜äººã€‚",
    "å¾Œèª¿ æ±æ–¹ 10": "æ©˜å­èˆ‡æª€é¦™æœ¨çš„å„ªé›…çµåˆï¼Œæ˜¯ä¸€ä½é¢¨åº¦ç¿©ç¿©çš„æ³•åœ‹ç´³å£«ï¼Œä½èª¿ä¸”å°Šè²´ã€‚",
    "å¾Œèª¿ æ±æ–¹ 11": "æ¢¨èˆ‡é¦™è‰çš„ç”œç³¯æ„Ÿï¼Œåƒæ˜¯ç«¥å¹´æœ€æ„›çš„é‚£é¡†æ¢…ç³–ï¼Œåœ¨èˆŒå°–ç·©ç·©åŒ–é–‹ã€‚",
    "å¾Œèª¿ æœ¨è³ª 01": "é›ªæ¾èˆ‡éºé¦™çš„å†·æš–å°æ¯”ï¼Œå¦‚åŒéŠ€è£ç´ è£¹çš„æ¾æ—ï¼Œæ¸…å†·è€Œåˆé€è‘—ç”Ÿæ©Ÿã€‚",
    "å¾Œèª¿ æœ¨è³ª 02": "ç™½æ¾é¦™èˆ‡æª€é¦™çš„æ²ˆéœï¼Œå¦‚åŒé€²å…¥ä¸€ç‰‡ç„¡äººæ‰“æ“¾çš„æ£®æ—æ·±è™•ï¼Œå‘¼å¸è‘—è‡ªç”±ã€‚",
    "å¾Œèª¿ æœ¨è³ª 03": "é¦™æ ¹è‰èˆ‡é›ªæ¾çš„ç´®å¯¦æ„Ÿï¼Œè³¦äºˆå¿ƒéˆä¸€ç¨®ç„¡èˆ‡å€«æ¯”çš„æ²‰ç©©èˆ‡å®šåŠ›ã€‚",
    "å¾Œèª¿ æœ¨è³ª 04": "é¾æ¶èˆ‡ç¥ç€çš„äº¤ç¹”ï¼Œå¦‚åŒæ™‚é–“é›•ç¢è€Œæˆçš„æ¨¹è„‚ï¼Œé–ƒçˆè‘—å¤§åœ°çš„å…‰è¼ã€‚",
    "å¾Œèª¿ æœ¨è³ª 05": "ç´”ç²¹çš„é›ªæ¾é¦™æ°£ï¼Œæ½”æ·¨ä¸”ç­†ç›´ï¼Œæ˜¯éˆé­‚æœ€ä¸å®¹å¦¥å”çš„åº•è‰²ã€‚",
    "å¾Œèª¿ æœ¨è³ª 06": "éºé¦™èˆ‡æ²‰é¦™çš„ç©ºéˆçµåˆï¼Œå½·å½¿è·¨è¶Šæ™‚ç©ºçš„å‘¼å¸ï¼Œç¸¹ç·²ä¸”ç¥è–ã€‚",
    "å¾Œèª¿ æœ¨è³ª 07": "é¦™è‰èˆ‡æ²‰é¦™çš„ç”œè‹¦äº¤ç¹”ï¼Œå¦‚åŒæ™¨é–“ç©¿é€å±±é¢¨çš„ç¬¬ä¸€ç¸·é™½å…‰ï¼Œå……æ»¿å¸Œæœ›ã€‚",
    "å¾Œèª¿ æœ¨è³ª 08": "æª€æœ¨èˆ‡é»‘èƒ¡æ¤’çš„èŠåš´æ„Ÿï¼Œåƒæ˜¯è¸å…¥éœè¬çš„å¯ºå»Ÿï¼Œæµ®èºç¬é–“æ¶ˆæ•£ç„¡è¹¤ã€‚",
    "å¾Œèª¿ æœ¨è³ª 09": "è¿·è¿­é¦™èˆ‡æ¨Ÿæœ¨çš„æ¸…å†½ï¼Œå¦‚é›²éœ§ç¹šç¹çš„å±±å·”ï¼Œæ¸…å†·ä¸”è®“äººå¿ƒæ› ç¥æ€¡ã€‚",
    "å¾Œèª¿ æœ¨è³ª 10": "æ²‰é¦™èˆ‡å»£è—¿é¦™çš„åšé‡æ„Ÿï¼Œæ˜¯è¨˜æ†¶ä¸­ç„¡æ³•æŠ¹å»çš„æ•…é„‰è¨˜æ†¶ï¼Œæ·±æƒ…ä¸”è¸å¯¦ã€‚",
    "å¾Œèª¿ æœ¨è³ª 11": "æ²‰é¦™èˆ‡å·´è¥¿ç´…æœ¨çš„æ¿€ç›ªï¼Œåœ¨ç„šé¦™çš„ç¸ˆç¹ä¸­ï¼Œå±•ç¾å‡ºä¸€ç¨®è¶…è„«å¡µä¸–çš„éœè¬ã€‚",
    "å¾Œèª¿ æœ¨è³ª 12": "æŸæ¨¹èˆ‡è‹¦æ©™çš„å …éŸŒï¼Œå¦‚åŒåœ¨æœˆå…‰ä¸‹æŒºæ‹”çš„æŸæ¨¹ï¼Œå®ˆè­·è‘—å¤œæ™šçš„å®‰å¯§ã€‚",
    "å¾Œèª¿ æœ¨è³ª 13": "ç´”æ·¨çš„æª€é¦™ï¼Œæº«æ½¤å¦‚ç‰ï¼Œæ˜¯æ™‚é–“æ²‰æ¾±ä¸‹ä¾†çš„æœ€æº«æŸ”çš„åº•æ°£ã€‚"
}

# ==========================================
# æ•¸æ“šåº« Bï¼šå‘½ç†ã€äººæ ¼èˆ‡æ¯”ä¾‹é‚è¼¯
# ==========================================
zodiac_db = {
    "ç™½ç¾Šåº§": "å‹‡æ°£èˆ‡æ´»åŠ›çš„é–‹æ‹“è€…ã€‚æ“æœ‰ä¸€å¾€ç„¡å‰çš„èƒ½é‡ï¼Œæ€§æ ¼ç´”ç²¹ã€ç›´ç‡ã€‚",
    "é‡‘ç‰›åº§": "è³ªæ„Ÿç”Ÿæ´»çš„å®ˆè­·è€…ã€‚æ„Ÿå®˜æ•éŠ³ï¼Œè¿½æ±‚ç©©å®šèˆ‡æ¥µè‡´çš„ç¾æ„Ÿã€‚",
    "é›™å­åº§": "å¥½å¥‡éˆå‹•çš„æ€æƒ³å‚³æ’­è€…ã€‚æ€ç¶­è·³èºã€ç†±æ„›æºé€šï¼Œéˆé­‚ä¸­è—è‘—é¢¨çš„è‡ªç”±ã€‚",
    "å·¨èŸ¹åº§": "ç´°è†©ç™‚ç™’çš„æƒ…æ„Ÿæº«å®¤ã€‚å®ˆè­·å…§åœ¨çš„å®‰å…¨æ„Ÿï¼Œæ„Ÿæ€§ä¸”å…·å‚™æ¥µå¼·å…±æƒ…åŠ›ã€‚",
    "ç…å­åº§": "è‡ªä¿¡é ˜å°çš„å‰µé€ åŠ›ä¸­å¿ƒã€‚æ“æœ‰å¼·å¤§çš„æ„å¿—èˆ‡æº«æš–çš„æ…·æ…¨ï¼Œå¦‚å¤ªé™½èˆ¬è€€çœ¼ã€‚",
    "è™•å¥³åº§": "è¿½æ±‚å®Œç¾çš„ç§©åºå·¥åŒ ã€‚å¿ƒæ€ç¸å¯†ï¼Œå…·å‚™å†·éœçš„è§€å¯ŸåŠ›èˆ‡ç´”æ·¨éˆé­‚åº•è‰²ã€‚",
    "å¤©ç§¤åº§": "å„ªé›…å¹³è¡¡çš„å”èª¿è—è¡“å®¶ã€‚è¿½æ±‚å’Œè«§èˆ‡ç¾æ„Ÿï¼Œè™•äº‹å¾å®¹ä¸è¿«ã€‚",
    "å¤©è åº§": "ç¥ç§˜æ´å¯Ÿçš„éˆé­‚æ¢æ¸¬å™¨ã€‚æƒ…æ„Ÿæ·±é‚ƒã€æ„å¿—å …å®šï¼Œæ°£è³ªé«˜å†·ä¸”æ¥µå…·ç£æ€§ã€‚",
    "å°„æ‰‹åº§": "å†’éšªè‡ªç”±çš„çœŸç†è¿½å°‹è€…ã€‚ç†±æ„›é æ–¹èˆ‡æ¢ç´¢ï¼Œæ“æœ‰ä¸€ç¨®ä¸è¢«ä¸–ä¿—æ‹˜æŸçš„æ°£å ´ã€‚",
    "æ‘©ç¾¯åº§": "è¸å¯¦è²¬ä»»çš„æ”€ç™»å…ˆé‹’ã€‚æ“æœ‰é©šäººçš„è€åŠ›èˆ‡é‡å¿ƒï¼Œæ°£è³ªæ²‰è‘—å†·éœã€‚",
    "æ°´ç“¶åº§": "ç¨ç«‹é©æ–°çš„æœªä¾†æ€æƒ³å®¶ã€‚æ€ç¶­è¶…å‰ã€ç‰¹ç«‹ç¨è¡Œï¼Œæ•£ç™¼è‘—æ™ºæ…§çš„ç¨ç‰¹é›»æ³¢ã€‚",
    "é›™é­šåº§": "éˆæ€§è—è¡“çš„å¤¢æƒ³ç·¨ç¹”è€…ã€‚éˆé­‚å……æ»¿è©©æ„ï¼Œæ„Ÿæ€§ä¸”æ…ˆæ‚²ã€‚"
}

element_traits = {
    "æ°´": "ã€æ°´èƒ½é‡ï¼šéˆæ€§æ™ºæ…§ã€‘å…·å‚™æ¥µå¼·çš„é©æ‡‰åŠ›èˆ‡ç©¿é€åŠ›ï¼Œæ€§æ ¼ç´°è†©åŒ…å®¹ã€‚",
    "æœ¨": "ã€æœ¨èƒ½é‡ï¼šæˆé•·ç”Ÿæ©Ÿã€‘ä»£è¡¨ç”Ÿå‘½åŠ›ï¼Œæ€§æ ¼ä»æ…ˆæ­£ç›´ï¼Œæ“æœ‰è‡ªæˆ‘çªç ´çš„æ¸´æœ›ã€‚",
    "ç«": "ã€ç«èƒ½é‡ï¼šç†±æƒ…ç†±çƒˆã€‘æ•£ç™¼æº«æš–ï¼Œæ€§æ ¼é–‹æœ—é‡è¦–ç¦®å„€ï¼Œå…·å¼·å¤§æ„ŸæŸ“åŠ›ã€‚",
    "é‡‘": "ã€é‡‘èƒ½é‡ï¼šå‰›æ¯…ç²¾æº–ã€‘æ“æœ‰æ±ºæ–·åŠ›ï¼Œæ€§æ ¼å†·éœæ­£ç›´ï¼Œè¿½æ±‚æ•ˆç‡èˆ‡æ ¸å¿ƒåƒ¹å€¼ã€‚",
    "åœŸ": "ã€åœŸèƒ½é‡ï¼šåšé‡ç©©å®šã€‘è±¡å¾µå¤§åœ°çš„åŒ…å®¹ï¼Œæ€§æ ¼æ²‰ç©©è¸å¯¦ï¼Œæ˜¯å€¼å¾—ä¿¡è³´çš„ä¾é ã€‚"
}

zodiac_animal_db = {
    "é¼ ": "æ©Ÿæ•ä¿è½ï¼Œè§€å¯Ÿç´°å¾®ã€‚", "ç‰›": "å‹¤å¥®ç©©é‡ï¼Œæ„å¿—åŠ›å¼·ã€‚", "è™": "å¨çŒ›æœæ•¢ï¼Œå…·é–‹å‰µç²¾ç¥ã€‚",
    "å…”": "æ–‡é›…æº«æŸ”ï¼Œå¿ƒæ€ç¸å¯†ã€‚", "é¾": "å®å‰ä¸å‡¡ï¼Œé ˜è¢–é­…åŠ›ã€‚", "è›‡": "å†·éœæ²‰è‘—ï¼Œç›´è¦ºéˆæ•ã€‚",
    "é¦¬": "å¥”æ”¾ç†±æƒ…ï¼Œç†±æ„›è‡ªç”±ã€‚", "ç¾Š": "é«”è²¼ä»æ…ˆï¼Œå…·è—è¡“æ„Ÿã€‚", "çŒ´": "è°æ˜è®Šé€šï¼Œå……æ»¿å‰µæ„ã€‚",
    "é›": "è² è²¬æœæ–·ï¼Œè¬›æ±‚ç´€å¾‹ã€‚", "ç‹—": "å¿ èª æ­£ç¾©ï¼Œå€¼å¾—ä¿¡è³´ã€‚", "è±¬": "çœŸèª åšé“ï¼Œæ€§æƒ…è±é”ã€‚"
}

zodiac_elements = {"é¼ ": "æ°´", "è±¬": "æ°´", "è™": "æœ¨", "å…”": "æœ¨", "è›‡": "ç«", "é¦¬": "ç«", "çŒ´": "é‡‘", "é›": "é‡‘", "ç‰›": "åœŸ", "é¾": "åœŸ", "ç¾Š": "åœŸ", "ç‹—": "åœŸ"}

mbti_db = {
    "INTJ (å»ºç¯‰å¸«)": {
        "top": ["å‰èª¿ èŠ³é¦™ 01", "å‰èª¿ æŸ‘è‹” 01", "å‰èª¿ èŠ³é¦™ 05"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 01", "ä¸­èª¿ èŠ±é¦™ 02", "ä¸­èª¿ èŠ±é¦™ 19"],
        "base": ["å¾Œèª¿ æœ¨è³ª 01", "å¾Œèª¿ æœ¨è³ª 08", "å¾Œèª¿ æœ¨è³ª 05"]
    },
    "INFP (èª¿è§£è€…)": {
        "top": ["å‰èª¿ èŠ³é¦™ 03", "å‰èª¿ èŠ³é¦™ 02", "å‰èª¿ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 19", "ä¸­èª¿ èŠ±é¦™ 03", "ä¸­èª¿ æœé¦™ 01"],
        "base": ["å¾Œèª¿ æœ¨è³ª 13", "å¾Œèª¿ æœ¨è³ª 02", "å¾Œèª¿ æ±æ–¹ 02"]
    },
    "INFJ (æå€¡è€…)": {
        "top": ["å‰èª¿ èŠ³é¦™ 09", "å‰èª¿ æŸ‘è‹” 04", "å‰èª¿ èŠ³é¦™ 05"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 04", "ä¸­èª¿ èŠ±é¦™ 06", "ä¸­èª¿ èŠ±é¦™ 14"],
        "base": ["å¾Œèª¿ æœ¨è³ª 11", "å¾Œèª¿ æœ¨è³ª 06", "å¾Œèª¿ æ±æ–¹ 02"]
    },
    "ENFP (ç«¶é¸è€…)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 04", "å‰èª¿ æŸ‘æ©˜ 02", "å‰èª¿ èŠ³é¦™ 08"],
        "mid": ["ä¸­èª¿ æœé¦™ 03", "ä¸­èª¿ æœé¦™ 04", "ä¸­èª¿ èŠ±é¦™ 07"],
        "base": ["å¾Œèª¿ æ±æ–¹ 06", "å¾Œèª¿ æ±æ–¹ 11", "å¾Œèª¿ æœ¨è³ª 13"]
    },
    "ENTJ (æŒ‡æ®å®˜)": {
        "top": ["å‰èª¿ èŠ³é¦™ 04", "å‰èª¿ æŸ‘è‹” 01", "å‰èª¿ æŸ‘æ©˜ 03"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 11", "ä¸­èª¿ æœé¦™ 05", "ä¸­èª¿ æœé¦™ 01"],
        "base": ["å¾Œèª¿ æ±æ–¹ 09", "å¾Œèª¿ æœ¨è³ª 08", "å¾Œèª¿ æ±æ–¹ 03"]
    },
    "ENTP (è¾¯è«–å®¶)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 04", "å‰èª¿ èŠ³é¦™ 07", "å‰èª¿ æŸ‘è‹” 03"],
        "mid": ["ä¸­èª¿ æœé¦™ 07", "ä¸­èª¿ æœé¦™ 08", "ä¸­èª¿ èŠ±é¦™ 17"],
        "base": ["å¾Œèª¿ æ±æ–¹ 03", "å¾Œèª¿ æ±æ–¹ 09", "å¾Œèª¿ æœ¨è³ª 11"]
    },
    "ENFJ (ä¸»äººå…¬)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 07", "å‰èª¿ èŠ³é¦™ 09", "å‰èª¿ æŸ‘æ©˜ 05"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 05", "ä¸­èª¿ èŠ±é¦™ 09", "ä¸­èª¿ æœé¦™ 06"],
        "base": ["å¾Œèª¿ æœ¨è³ª 13", "å¾Œèª¿ æ±æ–¹ 08", "å¾Œèª¿ æœ¨è³ª 12"]
    },
    "ISTJ (ç‰©æµå¸«)": {
        "top": ["å‰èª¿ èŠ³é¦™ 06", "å‰èª¿ æŸ‘è‹” 02", "å‰èª¿ èŠ³é¦™ 08"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 01", "ä¸­èª¿ èŠ±é¦™ 08", "ä¸­èª¿ æœé¦™ 12"],
        "base": ["å¾Œèª¿ æœ¨è³ª 05", "å¾Œèª¿ æœ¨è³ª 03", "å¾Œèª¿ æœ¨è³ª 10"]
    },
    "ISFJ (å®ˆè¡›è€…)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 07", "å‰èª¿ èŠ³é¦™ 02", "å‰èª¿ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 09", "ä¸­èª¿ èŠ±é¦™ 12", "ä¸­èª¿ èŠ±é¦™ 18"],
        "base": ["å¾Œèª¿ æœ¨è³ª 02", "å¾Œèª¿ æ±æ–¹ 08", "å¾Œèª¿ æœ¨è³ª 01"]
    },
    "ESTJ (ç¸½ç¶“ç†)": {
        "top": ["å‰èª¿ èŠ³é¦™ 02", "å‰èª¿ æŸ‘æ©˜ 05", "å‰èª¿ èŠ³é¦™ 08"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 01", "ä¸­èª¿ æœé¦™ 11", "ä¸­èª¿ æœé¦™ 12"],
        "base": ["å¾Œèª¿ æœ¨è³ª 03", "å¾Œèª¿ æœ¨è³ª 08", "å¾Œèª¿ æœ¨è³ª 10"]
    },
    "ESFJ (åŸ·æ”¿å®˜)": {
        "top": ["å‰èª¿ æœé¦™ 03", "å‰èª¿ æŸ‘æ©˜ 02", "å‰èª¿ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 14", "ä¸­èª¿ èŠ±é¦™ 16", "ä¸­èª¿ æœé¦™ 10"],
        "base": ["å¾Œèª¿ æ±æ–¹ 06", "å¾Œèª¿ æœ¨è³ª 13", "å¾Œèª¿ æ±æ–¹ 11"]
    },
    "ISTP (é‘‘è³å®¶)": {
        "top": ["å‰èª¿ èŠ³é¦™ 07", "å‰èª¿ æŸ‘è‹” 03", "å‰èª¿ èŠ³é¦™ 06"],
        "mid": ["ä¸­èª¿ æœé¦™ 09", "ä¸­èª¿ èŠ±é¦™ 08", "ä¸­èª¿ æœé¦™ 14"],
        "base": ["å¾Œèª¿ æœ¨è³ª 06", "å¾Œèª¿ æœ¨è³ª 12", "å¾Œèª¿ æ±æ–¹ 02"]
    },
    "ISFP (æ¢éšªå®¶)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 03", "å‰èª¿ èŠ³é¦™ 03", "å‰èª¿ æŸ‘æ©˜ 06"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 07", "ä¸­èª¿ æœé¦™ 02", "ä¸­èª¿ èŠ±é¦™ 03"],
        "base": ["å¾Œèª¿ æœ¨è³ª 07", "å¾Œèª¿ æ±æ–¹ 05", "å¾Œèª¿ æœ¨è³ª 04"]
    },
    "ESTP (ä¼æ¥­å®¶)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 04", "å‰èª¿ æŸ‘è‹” 01", "å‰èª¿ èŠ³é¦™ 04"],
        "mid": ["ä¸­èª¿ æœé¦™ 07", "ä¸­èª¿ æœé¦™ 08", "ä¸­èª¿ æœé¦™ 13"],
        "base": ["å¾Œèª¿ æ±æ–¹ 07", "å¾Œèª¿ æ±æ–¹ 09", "å¾Œèª¿ æœ¨è³ª 12"]
    },
    "ESFP (è¡¨æ¼”è€…)": {
        "top": ["å‰èª¿ æŸ‘æ©˜ 02", "å‰èª¿ æŸ‘æ©˜ 04", "å‰èª¿ æœé¦™ 04"],
        "mid": ["ä¸­èª¿ èŠ±é¦™ 10", "ä¸­èª¿ èŠ±é¦™ 13", "ä¸­èª¿ æœé¦™ 15"],
        "base": ["å¾Œèª¿ æ±æ–¹ 11", "å¾Œèª¿ æ±æ–¹ 06", "å¾Œèª¿ æ±æ–¹ 01"]
    },
    "INTP (é‚è¼¯å­¸å®¶)": {
        "top": ["å‰èª¿ èŠ³é¦™ 01", "å‰èª¿ èŠ³é¦™ 09", "å‰èª¿ æŸ‘è‹” 04"],
        "mid": ["ä¸­èª¿ æœé¦™ 14", "ä¸­èª¿ èŠ±é¦™ 06", "ä¸­èª¿ æœé¦™ 09"],
        "base": ["å¾Œèª¿ æœ¨è³ª 06", "å¾Œèª¿ æœ¨è³ª 11", "å¾Œèª¿ æ±æ–¹ 02"]
    }
}

zodiac_scents = {
    "ç™½ç¾Šåº§": {"top": "å‰èª¿ æŸ‘æ©˜ 04", "reason": "è‘¡è„æŸšçš„çˆ†ç™¼åŠ›å°æ‡‰é–‹æ‹“è€…ä¸ç†„çš„å‹‡æ°£èƒ½é‡ã€‚"},
    "é‡‘ç‰›åº§": {"top": "å‰èª¿ èŠ³é¦™ 05", "reason": "æ¢”å­èŠ±çš„ç´°è†©ç´”æ·¨ï¼Œå‘¼æ‡‰æ‚¨å°æ„Ÿå®˜å“è³ªèˆ‡è³ªæ„Ÿçš„è¿½æ±‚ã€‚"},
    "é›™å­åº§": {"top": "å‰èª¿ èŠ³é¦™ 02", "reason": "ç¾…å‹’èˆ‡ç™¾é‡Œé¦™çš„éˆå‹•ï¼Œè©®é‡‹æ‚¨è·³èºçš„å¥½å¥‡å¿ƒèˆ‡æ€è€ƒé€Ÿåº¦ã€‚"},
    "å·¨èŸ¹åº§": {"top": "å‰èª¿ èŠ³é¦™ 01", "reason": "æ¸…å†·çƒé¾å¾Œçš„æº«æ½¤é¤˜éŸ»ï¼Œç‡Ÿé€ å‡ºå¦‚å®¶ä¸€èˆ¬çš„æ­¸å±¬èˆ‡å®‰å…¨æ„Ÿã€‚"},
    "ç…å­åº§": {"top": "å‰èª¿ èŠ³é¦™ 04", "reason": "é¦¬éƒè˜­çš„è‚†æ„å¥”æ”¾ï¼Œå±•ç¾æ‚¨å¤©ç”Ÿçš„é ˜å°è€…é­…åŠ›èˆ‡å‰µé€ åŠ›æ°£å ´ã€‚"},
    "è™•å¥³åº§": {"top": "å‰èª¿ èŠ³é¦™ 06", "reason": "èŒ¶æ¨¹çš„æ¸…å†½èˆ‡ç´”æ·¨ï¼Œå‘¼æ‡‰æ‚¨å°äº‹ç‰©ç´°ç¯€èˆ‡å®Œç¾çš„æ¥µè‡´å …æŒã€‚"},
    "å¤©ç§¤åº§": {"top": "å‰èª¿ èŠ³é¦™ 09", "reason": "ç¶ èŒ¶çš„å„ªé›…æ¸…èŠ¬ï¼ŒåŠ©æ‚¨é”æˆå…§åœ¨éˆé­‚èˆ‡å¤–åœ¨ç’°å¢ƒçš„æ¥µè‡´å¹³è¡¡ã€‚"},
    "å¤©è åº§": {"top": "å‰èª¿ æŸ‘è‹” 01", "reason": "ç„¡èŠ±æœæœ¨çš„æ·±é‚ƒæ„Ÿï¼Œå°æ‡‰æ‚¨ç¥ç¥•çš„ç›´è¦ºèˆ‡å¼·å¤§çš„éˆé­‚è½‰åŒ–åŠ›ã€‚"},
    "å°„æ‰‹åº§": {"top": "å‰èª¿ èŠ³é¦™ 08", "reason": "é¦¬é­è‰çš„æ¸…çˆ½è·³èºï¼Œå¸¶é ˜éˆé­‚è¿½å°‹é æ–¹ä¸è¢«æŸç¸›çš„çµ•å°è‡ªç”±ã€‚"},
    "æ‘©ç¾¯åº§": {"top": "å‰èª¿ èŠ³é¦™ 01", "reason": "æ²ˆç©©çµæ§‹çš„å°è±†è”»èŒ¶é¦™ï¼Œå±•ç¾æ‚¨è¸å¯¦å‰è¡Œã€å€¼å¾—ä¿¡è³´çš„è²¬ä»»æ„Ÿã€‚"},
    "æ°´ç“¶åº§": {"top": "å‰èª¿ èŠ³é¦™ 07", "reason": "æ¥µè‡´æ¸…æ¶¼çš„è–„è·ï¼Œè‡´æ•¬æ‚¨ç‰¹ç«‹ç¨è¡Œã€é©æ–°æœªä¾†çš„äººé“ä¸»ç¾©éˆé­‚ã€‚"},
    "é›™é­šåº§": {"top": "å‰èª¿ èŠ³é¦™ 03", "reason": "å«ç¾è‰çš„å¤¢å¹»ç²‰æ„Ÿï¼Œè®“æ‚¨çš„è—è¡“éˆé­‚åœ¨å¤¢å¢ƒèˆ‡ç¾å¯¦é–“æµªæ¼«å‘¼å¸ã€‚"}
}

element_scents = {
    "æ°´": {"base": "å¾Œèª¿ æ±æ–¹ 02"}, "æœ¨": {"base": "å¾Œèª¿ æœ¨è³ª 02"},
    "ç«": {"base": "å¾Œèª¿ æ±æ–¹ 06"}, "é‡‘": {"base": "å¾Œèª¿ æœ¨è³ª 05"}, "åœŸ": {"base": "å¾Œèª¿ æœ¨è³ª 08"}
}

model_logic = {
    "é»ƒé‡‘å¹³è¡¡å‹ (20:35:45)": {"ratios": [0.20, 0.35, 0.45], "desc": "æœ€ç©©å®šçš„çµæ§‹ï¼Œé¦™æ°£éŠœæ¥å¹³æ»‘ã€‚"},
    "æ¸…æ–°çˆ†ç™¼å‹ (40:35:25)": {"ratios": [0.40, 0.35, 0.25], "desc": "å¼·åŒ–å‰èª¿çˆ†ç™¼åŠ›ï¼Œé©åˆæ¸…çˆ½æç¥ã€‚"},
    "æ·±é‚ƒç•™é¦™å‹ (15:30:55)": {"ratios": [0.15, 0.30, 0.55], "desc": "åŠ é‡å¾Œèª¿æ¯”é‡ï¼Œå±•ç¾æŒä¹…é­…åŠ›ã€‚"}
}

perfume_logic = {
    "æ—¥å¸¸é€šå‹¤": {"type": "EDT", "total_oil": 1.0}, "ç´„æœƒæ´¾å°": {"type": "EDP", "total_oil": 1.5},
    "å•†å‹™æ­£å¼": {"type": "EDP", "total_oil": 1.2}, "é‹å‹•ä¼‘é–’": {"type": "Cologne", "total_oil": 0.8},
    "å†¥æƒ³ç¡çœ ": {"type": "Mist", "total_oil": 0.6}
}

# ==========================================
# æ•¸æ“šåº« Cï¼šMBTI ç°¡æ˜“æ¸¬è©¦é¡Œç›®
# ==========================================
mbti_questions = [
    # E/I ç¶­åº¦
    {"dimension": "EI", "question": "åœ¨ç¤¾äº¤å ´åˆä¸­ï¼Œä½ é€šå¸¸æœƒï¼š",
     "options": [("ä¸»å‹•èªè­˜æ–°æœ‹å‹ï¼Œäº«å—äº¤æµ", "E"), ("å¾…åœ¨ç†Ÿæ‚‰çš„äººæ—é‚Šï¼Œæˆ–æ‰¾å®‰éœè§’è½", "I")]},
    {"dimension": "EI", "question": "ç¶“éå¿™ç¢Œçš„ä¸€å¤©å¾Œï¼Œä½ å‚¾å‘ç”¨ä»€éº¼æ–¹å¼å……é›»ï¼Ÿ",
     "options": [("å’Œæœ‹å‹èšæœƒèŠå¤©", "E"), ("ç¨è™•æˆ–å®‰éœåœ°ä¼‘æ¯", "I")]},
    # S/N ç¶­åº¦
    {"dimension": "SN", "question": "ä½ åœ¨æ€è€ƒäº‹æƒ…æ™‚ï¼Œæ›´æ³¨é‡ï¼š",
     "options": [("å…·é«”çš„äº‹å¯¦å’Œç´°ç¯€", "S"), ("æ•´é«”æ¦‚å¿µå’Œæœªä¾†å¯èƒ½æ€§", "N")]},
    {"dimension": "SN", "question": "ä½ æ›´ç›¸ä¿¡ï¼š",
     "options": [("å¯¦éš›ç¶“é©—å’Œçœ¼è¦‹ç‚ºæ†‘", "S"), ("ç›´è¦ºå’Œç¬¬å…­æ„Ÿ", "N")]},
    # T/F ç¶­åº¦
    {"dimension": "TF", "question": "åšé‡è¦æ±ºå®šæ™‚ï¼Œä½ æ›´ä¾è³´ï¼š",
     "options": [("å®¢è§€çš„é‚è¼¯åˆ†æ", "T"), ("å€‹äººåƒ¹å€¼è§€å’Œå°ä»–äººçš„å½±éŸ¿", "F")]},
    {"dimension": "TF", "question": "ç•¶æœ‹å‹é‡åˆ°å›°é›£å‘ä½ å‚¾è¨´æ™‚ï¼Œä½ æœƒå…ˆï¼š",
     "options": [("å¹«å¿™åˆ†æå•é¡Œä¸¦æä¾›è§£æ±ºæ–¹æ¡ˆ", "T"), ("å‚¾è½ä¸¦çµ¦äºˆæƒ…æ„Ÿæ”¯æŒ", "F")]},
    # J/P ç¶­åº¦
    {"dimension": "JP", "question": "å°æ–¼ç”Ÿæ´»å’Œå·¥ä½œï¼Œä½ æ›´å–œæ­¡ï¼š",
     "options": [("äº‹å…ˆè¨ˆåŠƒå¥½ï¼ŒæŒ‰éƒ¨å°±ç­", "J"), ("ä¿æŒå½ˆæ€§ï¼Œéš¨æ©Ÿæ‡‰è®Š", "P")]},
    {"dimension": "JP", "question": "é¢å°æˆªæ­¢æ—¥æœŸï¼Œä½ é€šå¸¸æœƒï¼š",
     "options": [("æå‰å®Œæˆï¼Œé¿å…å£“åŠ›", "J"), ("åœ¨æœ€å¾ŒæœŸé™å‰æ‰å®Œæˆï¼Œäº«å—å£“åŠ›å¸¶ä¾†çš„å‹•åŠ›", "P")]},
]

def calculate_mbti(answers):
    """æ ¹æ“šæ¸¬è©¦ç­”æ¡ˆè¨ˆç®— MBTI é¡å‹"""
    scores = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}
    for ans in answers:
        if ans:
            scores[ans] += 1

    mbti = ""
    mbti += "E" if scores["E"] >= scores["I"] else "I"
    mbti += "S" if scores["S"] >= scores["N"] else "N"
    mbti += "T" if scores["T"] >= scores["F"] else "F"
    mbti += "J" if scores["J"] >= scores["P"] else "P"

    # å°æ‡‰åˆ°å®Œæ•´çš„ MBTI åç¨±
    mbti_names = {
        "INTJ": "INTJ (å»ºç¯‰å¸«)", "INFP": "INFP (èª¿è§£è€…)", "INFJ": "INFJ (æå€¡è€…)",
        "ENFP": "ENFP (ç«¶é¸è€…)", "ENTJ": "ENTJ (æŒ‡æ®å®˜)", "ENTP": "ENTP (è¾¯è«–å®¶)",
        "ENFJ": "ENFJ (ä¸»äººå…¬)", "ISTJ": "ISTJ (ç‰©æµå¸«)", "ISFJ": "ISFJ (å®ˆè¡›è€…)",
        "ESTJ": "ESTJ (ç¸½ç¶“ç†)", "ESFJ": "ESFJ (åŸ·æ”¿å®˜)", "ISTP": "ISTP (é‘‘è³å®¶)",
        "ISFP": "ISFP (æ¢éšªå®¶)", "ESTP": "ESTP (ä¼æ¥­å®¶)", "ESFP": "ESFP (è¡¨æ¼”è€…)",
        "INTP": "INTP (é‚è¼¯å­¸å®¶)"
    }
    return mbti_names.get(mbti, f"{mbti}")

# ==========================================
# æ ¸å¿ƒå‡½æ•¸
# ==========================================
def translate_scents(code_list):
    html_snippets = ""
    for i, code in enumerate(code_list):
        full_info = scent_map.get(code, f"{code} (å°ˆå±¬é…æ–¹)")
        name = full_info.split(" (")[0] if " (" in full_info else full_info
        ing = "(" + full_info.split(" (")[1] if " (" in full_info else ""
        desc = scent_descriptions.get(code, "é€™æ¬¾é¦™æ°£èƒ½å„ªé›…å¹³è¡¡ä½ çš„å…§åœ¨èƒ½é‡ã€‚")
        html_snippets += f"<div style='margin-bottom:8px; padding:10px; border-radius:10px; background:rgba(255,255,255,0.45); border:0.5px solid #eee;'><div style='color: #8B4513; font-weight: bold; font-size: 14px;'>å»ºè­°: {name}</div><div style='font-size: 11px; color: #666;'>{ing}</div><div style='font-size: 10px; color: #9E7E6B; margin-top:4px;'><i>{desc}</i></div></div>"
    return html_snippets

def get_zodiac(m, d):
    signs = [(1,20,"æ‘©ç¾¯åº§"),(2,19,"æ°´ç“¶åº§"),(3,21,"é›™é­šåº§"),(4,20,"ç™½ç¾Šåº§"),(5,21,"é‡‘ç‰›åº§"),(6,22,"é›™å­åº§"),(7,23,"å·¨èŸ¹åº§"),(8,23,"ç…å­åº§"),(9,23,"è™•å¥³åº§"),(10,24,"å¤©ç§¤åº§"),(11,23,"å¤©è åº§"),(12,22,"å°„æ‰‹åº§"),(12,31,"æ‘©ç¾¯åº§")]
    for mm, dd, s in signs:
        if m < mm or (m == mm and d <= dd): return s
    return "æ‘©ç¾¯åº§"

def get_life_num(bday):
    d = "".join(filter(str.isdigit, str(bday)))
    while len(d) > 1: d = str(sum(int(x) for x in d))
    return d

def get_chinese_zodiac(year):
    animals = ["çŒ´", "é›", "ç‹—", "è±¬", "é¼ ", "ç‰›", "è™", "å…”", "é¾", "è›‡", "é¦¬", "ç¾Š"]
    return animals[year % 12]

# ==========================================
# åˆ†é æ§åˆ¶é‚è¼¯ (Step-by-Step)
# ==========================================
st.title("ğŸ§ª Aroma's Secret Lab")

if "step" not in st.session_state:
    st.session_state.step = 1

# é€²åº¦æ¢
progress_map = {1: 0.25, 2: 0.5, 3: 0.75, 4: 1.0}
current_progress = progress_map.get(st.session_state.step, 1.0)
if st.session_state.get("taking_mbti_test", False):
    current_progress = 0.5  # æ¸¬è©¦ä¸­ä¹Ÿé¡¯ç¤º 50%
st.progress(current_progress)

# --- Step 1: å‘½é‹åŸºç›¤ ---
if st.session_state.step == 1:
    st.subheader("Step 1: ğŸŒŒ å‘½é‹åŸºç›¤èƒ½é‡")
    st.info("AI å°‡æ ¹æ“šæ‚¨çš„å‡ºç”Ÿæ™‚åˆ»ï¼Œå®šä½æ˜Ÿç›¤åæ¨™èˆ‡ç”Ÿè‚–äº”è¡Œèƒ½é‡ã€‚")
    st.session_state.birthday = st.date_input("ğŸ“… æ‚¨çš„å‡ºç”Ÿå¹´æœˆæ—¥", value=date(2000, 1, 1), key="step1_birthday")
    if st.button("ä¸‹ä¸€æ­¥ï¼šæ¢ç´¢æ€§æ ¼åŸºå›  â”"):
        st.session_state.step = 2
        st.rerun()

# --- Step 2: æ€§æ ¼åŸºå›  ---
elif st.session_state.step == 2:
    st.subheader("Step 2: ğŸ§  å…§åœ¨æ€§æ ¼åŸºå› ")
    st.info("æ€§æ ¼å½±éŸ¿é¦™å‘³çš„ä¸­èª¿é¸æ“‡ï¼Œé€™æ˜¯é¦™æ°´çš„éˆé­‚æ ¸å¿ƒã€‚")

    # æª¢æŸ¥æ˜¯å¦æ­£åœ¨é€²è¡Œ MBTI æ¸¬è©¦
    if st.session_state.get("taking_mbti_test", False):
        st.markdown("### ğŸ“ MBTI ç°¡æ˜“æ¸¬è©¦")
        st.caption("è«‹æ ¹æ“šç›´è¦ºé¸æ“‡æœ€ç¬¦åˆä½ çš„é¸é …ï¼ˆå…± 8 é¡Œï¼‰")

        # åˆå§‹åŒ–ç­”æ¡ˆåˆ—è¡¨
        if "mbti_answers" not in st.session_state:
            st.session_state.mbti_answers = [None] * 8

        # é¡¯ç¤ºæ‰€æœ‰é¡Œç›®
        for i, q in enumerate(mbti_questions):
            st.markdown(f"**Q{i+1}. {q['question']}**")
            options = [opt[0] for opt in q["options"]]

            # ä½¿ç”¨ radio è®“ç”¨æˆ¶é¸æ“‡
            choice = st.radio(
                f"é¸æ“‡ Q{i+1}",
                options=options,
                index=None,
                key=f"mbti_q_{i}",
                label_visibility="collapsed"
            )

            # è¨˜éŒ„ç­”æ¡ˆ
            if choice:
                for opt_text, opt_value in q["options"]:
                    if choice == opt_text:
                        st.session_state.mbti_answers[i] = opt_value
                        break
            st.markdown("---")

        col1, col2 = st.columns(2)
        with col1:
            if st.button("â¬… è¿”å›é¸æ“‡ MBTI"):
                st.session_state.taking_mbti_test = False
                st.session_state.mbti_answers = [None] * 8
                st.rerun()
        with col2:
            # æª¢æŸ¥æ˜¯å¦æ‰€æœ‰é¡Œç›®éƒ½å·²ä½œç­”
            all_answered = all(ans is not None for ans in st.session_state.mbti_answers)
            if st.button("å®Œæˆæ¸¬è©¦ âœ“", disabled=not all_answered):
                # è¨ˆç®— MBTI çµæœ
                result = calculate_mbti(st.session_state.mbti_answers)
                st.session_state.mbti_choice = result
                st.session_state.taking_mbti_test = False
                st.session_state.mbti_answers = [None] * 8
                st.session_state.step = 3
                st.rerun()

        if not all_answered:
            st.warning("è«‹å®Œæˆæ‰€æœ‰é¡Œç›®å¾Œå†ç¹¼çºŒ")

    else:
        # æ­£å¸¸çš„ MBTI é¸æ“‡ä»‹é¢
        st.session_state.mbti_choice = st.selectbox(
            "ğŸ§  æ‚¨çš„ MBTI äººæ ¼",
            list(mbti_db.keys()),
            key="step2_mbti"
        )

        # æ–°å¢ï¼šä¸çŸ¥é“ MBTI çš„æŒ‰éˆ•
        if st.button("ğŸ¤” æˆ‘ä¸çŸ¥é“æˆ‘çš„ MBTIï¼Œé€²è¡Œæ¸¬è©¦"):
            st.session_state.taking_mbti_test = True
            st.rerun()

        col1, col2 = st.columns(2)
        with col1:
            if st.button("â¬… è¿”å›ä¸Šä¸€æ­¥"):
                st.session_state.step = 1
                st.rerun()
        with col2:
            if st.button("ä¸‹ä¸€æ­¥ï¼šæ°£å‘³å ´æ™¯å»ºæ¨¡ â”"):
                st.session_state.step = 3
                st.rerun()

# --- Step 3: æ°£å‘³å»ºæ¨¡ ---
elif st.session_state.step == 3:
    st.subheader("Step 3: ğŸ“ æ°£å‘³å ´æ™¯å»ºæ¨¡")
    st.info("é¸æ“‡ä½¿ç”¨çš„å ´åˆèˆ‡æ‚¨åå¥½çš„é¦™æ°£çµæ§‹ã€‚")
    st.session_state.occasion = st.selectbox("ğŸ™ï¸ é è¨ˆä½¿ç”¨å ´åˆ", list(perfume_logic.keys()), key="step3_occ")
    st.session_state.selected_model = st.selectbox("ğŸ“ é¦™æ°£çµæ§‹æ¨¡å‹", list(model_logic.keys()), key="step3_model")

    col1, col2 = st.columns(2)
    with col1:
        if st.button("â¬… è¿”å›ä¸Šä¸€æ­¥"):
            st.session_state.step = 2
            st.rerun()
    with col2:
        if st.button("ğŸ”® å•Ÿå‹• AI æ·±åº¦åˆ†æ"):
            st.session_state.step = 4
            st.rerun()

# --- Step 4: çµæœå±•ç¤º ---
elif st.session_state.step == 4:
    # åˆ¤æ–·æ˜¯å¦å·²ç¶“é‹è¡Œéè¼‰å…¥å‹•ç•«
    if "done_loading" not in st.session_state:
        progress_bar = st.progress(0)
        status_text = st.empty()
        loading_steps = [
            {"text": "ğŸŒŒ æ­£åœ¨èª¿å–æ˜Ÿç›¤åæ¨™ï¼Œå°é½Šé»ƒé“åäºŒå®®è„ˆçµ¡...", "t": 1.2},
            {"text": "ğŸ® è®€å–ç”Ÿè‚–å‘½ç†ï¼Œè¨ˆç®—äº”è¡Œèƒ½é‡æµå‹•...", "t": 1.0},
            {"text": "ğŸ§ª æ­£åœ¨å¾æ°£å‘³åº«ä¸­ç¯©é¸éˆé­‚æ°£å‘³åŸºå› ...", "t": 1.5},
            {"text": "ğŸ§  åŒ¹é…äººæ ¼æ ¸å¿ƒï¼Œæ’é™¤åˆ†å­æ’æ–¥åæ‡‰...", "t": 1.3},
            {"text": "âš–ï¸ æ­£åœ¨æ ¡æº–æœ€ä½³ 10ml èª¿é…æ»´æ•¸...", "t": 0.8}
        ]
        for i, step in enumerate(loading_steps):
            status_text.markdown(f"**{step['text']}**")
            time.sleep(step['t'])
            progress_bar.progress((i + 1) / len(loading_steps))

        status_text.empty()
        progress_bar.empty()
        st.session_state.done_loading = True
        st.rerun()

    # åŸ·è¡Œå¯¦éš›é‹ç®—
    birthday = st.session_state.birthday
    mbti_choice = st.session_state.mbti_choice
    occasion = st.session_state.occasion
    selected_model = st.session_state.selected_model

    z_name = get_zodiac(birthday.month, birthday.day)
    c_zodiac = get_chinese_zodiac(birthday.year)
    c_element = zodiac_elements[c_zodiac]
    l_num = get_life_num(birthday)

    res = mbti_db[mbti_choice]
    occ_data = perfume_logic[occasion]
    model_data = model_logic[selected_model]
    z_scent = zodiac_scents.get(z_name, {"top": "å‰èª¿ èŠ³é¦™ 01", "reason": "èƒ½é‡å¼•å°"})
    e_data = element_scents.get(c_element, {"base": "å¾Œèª¿ æœ¨è³ª 08"})

    # å»é‡ä¸¦é™åˆ¶ 3 å€‹
    final_top = list(dict.fromkeys([z_scent["top"]] + res['top']))[:3]
    final_mid = list(dict.fromkeys(res['mid']))[:3]
    final_base = list(dict.fromkeys([e_data["base"]] + res['base']))[:3]

    # æ¸²æŸ“å¡ç‰‡
    st.markdown(f"""
    <div style="background: white; padding: 25px; border-radius: 20px; border: 2px solid #1a1a1a; box-shadow: 8px 8px 0px #F5F5F5; color: #333;">
        <h2 style="text-align:center; color:#8B4513;">ğŸ§¬ AI å…¨ç¶­åº¦å°ˆå±¬é…æ–¹</h2>
        <div style="display:flex; justify-content:center; gap:10px; margin:15px 0;">
            <span style="background:#E3F2FD; padding:4px 10px; border-radius:10px; font-size:11px;">ğŸŒ  {z_name}</span>
            <span style="background:#F3E5F5; padding:4px 10px; border-radius:10px; font-size:11px;">ğŸ® {c_zodiac}({c_element})</span>
            <span style="background:#E8F5E9; padding:4px 10px; border-radius:10px; font-size:11px;">ğŸ”¢ éˆæ•¸ {l_num}</span>
        </div>
        <div style="font-size: 12px; color: #4A5568; line-height: 1.6; background: #FAFAFA; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 0.5px solid #EDF2F7;">
            <p style="margin:0 0 10px 0;"><b>âœ¨ æ˜Ÿåº§ç‰¹è³ªï¼š</b>{zodiac_db.get(z_name, "èƒ½é‡å¼•å°è€…")}</p>
            <p style="margin:0;"><b>â˜¯ï¸ äº”è¡Œèƒ½é‡ï¼š</b>{element_traits.get(c_element, "ç©©å®šåº•è˜Š")}</p>
        </div>
        <div style="background:#FFF9F0; padding:10px; border-radius:10px; border-left: 5px solid #D4AF37;">
            <p style="font-weight:bold; margin:0;">ã€å‰èª¿å»ºè­°ã€‘</p>{translate_scents(final_top)}
            <p style="font-weight:bold; margin:10px 0 0 0;">ã€ä¸­èª¿å»ºè­°ã€‘</p>{translate_scents(final_mid)}
            <p style="font-weight:bold; margin:10px 0 0 0;">ã€å¾Œèª¿å»ºè­°ã€‘</p>{translate_scents(final_base)}
        </div>
    </div>
    """, unsafe_allow_html=True)

    # é…æ¯”é¡¯ç¤º
    st.write("---")
    st.subheader(f"ğŸ§ª å°ˆæ¥­é…æ¯”å»ºè­°ï¼š{selected_model}")
    r, total, df = model_data["ratios"], occ_data["total_oil"], 25
    c1, c2, c3 = st.columns(3)
    c1.metric("å‰èª¿", f"{round(total*r[0],2)}ml", f"{round(total*r[0]*df)}æ»´")
    c2.metric("ä¸­èª¿", f"{round(total*r[1],2)}ml", f"{round(total*r[1]*df)}æ»´")
    c3.metric("å¾Œèª¿", f"{round(total*r[2],2)}ml", f"{round(total*r[2]*df)}æ»´")

    st.balloons()
    if st.button("ğŸ”„ é‡æ–°é–‹å§‹åˆ†æ"):
        st.session_state.clear()
        st.rerun()
